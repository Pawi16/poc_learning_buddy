openapi: 3.0.3
info:
  title: Learning Buddy API
  version: 1.0.0
servers:
  - url: http://localhost:8080/api/v1

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

# Auth

paths:
  /auth/register:
    post:
      summary: Register a new user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/RegisterRequest.yaml' 
      responses:
        '201':
          description: Account created successfully.
        '400':
          description: Validation Failed.
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'

  /auth/login:
    post:
      summary: Login user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/LoginRequest.yaml'
      responses:
        '200':
          description: Login successful.
          content:
            application/json:
              schema:
                $ref: './schemas/AuthResponse.yaml'

# Course Management

  /courses/preview:
    post:
      summary: Upload PDF to get Course Preview
      description:
        Accepts a PDF and Course Metadata.
        Returns a "CoursePreview" object (Topics + Summaries) generated by AI.
      tags: [Courses]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - title
                - file
              properties:
                title:
                  type: string
                description:
                  type: string
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Returns the Preview data
          content:
            application/json:
              schema:
                $ref: './schemas/CoursePreviewResponse'
        '400' :
          description: Validation Failed (Missing Title, Invalid File Type/Size)
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse'
        '503':
          description: AI Service Unavailable
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse'

  /courses:
    post:
      summary: Save new course
      tags: [Courses]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/CreateCourseRequest.yaml'
      responses:
        '201':
            description: Course created successfully.
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    course_id:
                      type: integer
                    message:
                      type: string
        '400':
          description: Validation Failed (Missing Topic Content)
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse'
  
  /courses/{id}:
    patch:
      summary: Edit Course Metadata & Publish/Unpublish Course
      tags: [Courses]
      security:
        - bearerAuth: []
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        required: true
        description: "The ID of the course to update."
        example: 101
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './schemas/UpdateCourseRequest.yaml'
      responses:
        '200':
          description: Update Successful.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Course updated successfully."
        '400':
          description: Validation Failed (e.g. Title is null).
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
              example:
                status: 400
                error: "Bad Request"
                message: "Validation failed"
                details: ["title: This field is required."]
        '403':
          description: Forbidden. (User is not the owner of this course).
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
                example:
                  status: 403
                  error: "Forbidden"
                  message: "You do not have permission to edit this course."
        '404':
          description: Course not found.
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
    delete:
      summary: Delete Course
      description: |
        Permanently deletes a course and all associated data (Topics, Quizzes, Flashcards).
      tags: [Courses]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: "ID of the course to delete."
      responses:
        '200':
          description: Course deleted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Course deleted successfully."
        '403':
          description: Forbidden (Not the owner).
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
        '404':
          description: Course not found.
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml
  
  /courses/{id}/content:
    get:
      summary: Get Course Content for Editing
      description:
        Fetches the full list of topics, including raw_text and summary_notes.
        Used when the Instructor opens the "Edit Content" tab.
      tags: [Courses]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: "Course ID"
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  course_id:
                    type: integer
                  topics:
                    type: array
                    items:
                      $ref: './schemas/TopicDetail.yaml' 
        '403':
          description: Forbidden. (User is not the owner of this course).
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
                example:
                  status: 403
                  error: "Forbidden"
                  message: "You do not have permission to edit this course."
        '404':
          description: Course not found.
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
    put:
      summary: Update All Course Content
      description: |
        Replaces the course topics with the new list provided.
        - If a topic has an ID, update it.
        - If a topic has no ID, insert it.
        - If a topic is missing from this list, delete it.
        **Use Case 6: Edit Course Content**
      tags:
        - Courses
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - topics
              properties:
                topics:
                  type: array
                  items:
                    $ref: './schemas/TopicDetail.yaml'
      responses:
        '200':
          description: Content updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Course content saved."
        '400':
          description: Validation Failed (Null fields in topics).
          content:
            application/json:
              schema:
                $ref: './schemas/ErrorResponse.yaml'
              example:
                status: 400
                message: "Validation failed"
                details: ["topics[0].raw_text: This field is required."]

  /courses/my:
    get:
      summary: View My Created Courses
      description: |
        Retrieves a list of all courses created by the logged-in Instructor.
        Includes both Published and Draft courses.
      tags: [Courses]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: './schemas/CourseSummaryResponse.yaml'

#Quiz





